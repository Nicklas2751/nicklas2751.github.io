<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.3">Jekyll</generator><link href="https://nicklas.wiegandt.eu/feed/by_tag/containerd.xml" rel="self" type="application/atom+xml" /><link href="https://nicklas.wiegandt.eu/" rel="alternate" type="text/html" /><updated>2024-12-03T06:19:45-06:00</updated><id>https://nicklas.wiegandt.eu/feed/by_tag/containerd.xml</id><title type="html">Nicklas Wiegandt</title><subtitle>About Nicklas Wiegandt (Nicklas2751) and his Blog.</subtitle><author><name>Nicklas Wiegandt</name></author><entry><title type="html">Using Docker in jenkins with jenkins Docker agent</title><link href="https://nicklas.wiegandt.eu/2021/06/06/jenkins-docker-agent-with-docker.html" rel="alternate" type="text/html" title="Using Docker in jenkins with jenkins Docker agent" /><published>2021-06-06T03:00:00-05:00</published><updated>2021-06-06T03:00:00-05:00</updated><id>https://nicklas.wiegandt.eu/2021/06/06/jenkins-docker-agent-with-docker</id><content type="html" xml:base="https://nicklas.wiegandt.eu/2021/06/06/jenkins-docker-agent-with-docker.html">&lt;div id=&quot;preamble&quot;&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Getting &lt;a href=&quot;https://jenkins.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Jenkins CI&lt;/a&gt; to build Docker container with a jenkins Docker agent&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-problem&quot;&gt;The problem&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Running &lt;a href=&quot;https://jenkins.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Jenkins CI&lt;/a&gt; agents as containers is a nice thing. However it can be a
hassle if you want to build a container inside the containerized docker agent. Using the standard Jenkins agent container
will result in an error telling you that the Docker binary is not found.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-solution&quot;&gt;The solution&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The default &lt;a href=&quot;https://hub.docker.com/r/jenkins/agent&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Jenkins agent container&lt;/a&gt; doesn&amp;#8217;t contain the Docker binaries. ðŸ˜”&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;But the &lt;a href=&quot;https://hub.docker.com/r/jenkins/jnlp-agent-docker&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Jenkins JNLP agent Docker container&lt;/a&gt; does! ðŸ˜€&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Unfortunately the image is missing any description and finding any documentation is hard. You can neither view the Dockerfile nor is the source linked. But in the &lt;a href=&quot;https://github.com/jenkinsci/jnlp-agents&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub repository&lt;/a&gt; for the &lt;a href=&quot;https://github.com/jenkinsci/jnlp-agents&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;JNLP Agents&lt;/a&gt; is a subdirectory called &lt;code&gt;docker&lt;/code&gt; in which you can find this &lt;a href=&quot;https://github.com/jenkinsci/jnlp-agents/blob/master/docker/Dockerfile&quot;&gt;Dockerfile&lt;/a&gt;. This seems to be the source for the linked image. One can see that the Docker binary is getting installed on build time.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;In order to use the agent go to your Jenkins server settings and click on &lt;code&gt;Manage Nodes and Clouds&lt;/code&gt; &amp;#8594; &lt;code&gt;Configure Clouds&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;If you haven&amp;#8217;t already set your Docker settings:&lt;br&gt;
&lt;strong&gt;Name:&lt;/strong&gt; &lt;code&gt;docker&lt;/code&gt;&lt;br&gt;
&lt;strong&gt;Docker Host URI:&lt;/strong&gt; &lt;code&gt;unix:///var/run/docker.sock&lt;/code&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;assets/images/jenkins-configure-clouds.png&quot; alt=&quot;The Jenkins Docker settings&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;The Jenkins Docker setting&lt;/div&gt;
&lt;p&gt;Then open the Docker Agent templates section.&lt;br&gt;
Change the &lt;strong&gt;Docker Image&lt;/strong&gt; to: &lt;code&gt;jenkins/jnlp-agent-docker&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;assets/images/jenkins-agent-template.png&quot; alt=&quot;The Jenkins agent template settings&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;The Jenkins agent template settings&lt;/div&gt;
&lt;p&gt;After that open the container settings and set the following:&lt;br&gt;
&lt;strong&gt;User:&lt;/strong&gt; &lt;code&gt;root&lt;/code&gt;&lt;br&gt;
&lt;strong&gt;Volumes:&lt;/strong&gt; &lt;code&gt;/var/run/docker.sock:/var/run/docker.sock&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;assets/images/jenkins-agent-template-container-settings.png&quot; alt=&quot;The Jenkins agent template container settings&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;The Jenkins agent template container settings&lt;/div&gt;
&lt;p&gt;Thats it. Happy dockerizing ðŸ™‚&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</content><author><name>Nicklas Wiegandt</name></author><category term="jenkins" /><category term="cicd" /><category term="docker" /><category term="docker-in-docker" /><category term="containerd" /><summary type="html">Getting Jenkins CI to build Docker container with a jenkins Docker agent</summary></entry></feed>